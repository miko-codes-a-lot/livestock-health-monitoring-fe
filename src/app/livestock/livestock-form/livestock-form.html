<div class="form-container">
  <form [formGroup]="rxform" (ngSubmit)="onSubmit()" class="livestock-form">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Livestock Information</mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <!-- Animal Photos Section -->
        <div class="form-row animal-photos-section">
          <label class="section-label">Animal Photos</label>

          <!-- New previews -->
          <div *ngIf="previewPhotos.length > 0" class="photos-container">
            <div class="animal-photos-preview">
              <div class="photo-card" *ngFor="let preview of previewPhotos">
                <img [src]="preview" alt="New photo preview" class="animal-photo" />
              </div>
            </div>
          </div>

          <!-- Upload Button -->
          <label for="animalPhotos" class="upload-btn">
            <span>Upload Photos</span>
            <input id="animalPhotos" type="file" (change)="onFilesSelected($event)" multiple hidden />
          </label>
        </div>

        <!-- Row 1: Tag Number, Classification, Breed -->
        <div class="form-row">
          <mat-form-field appearance="outline" class="third-width">
            <mat-label>Tag Number</mat-label>
            <input matInput formControlName="tagNumber" type="text" />
            <mat-error *ngIf="tagNumber.hasError('required')">
              Tag Number is required.
            </mat-error>
          </mat-form-field>

          <!-- Dynamic Classifications -->
          <mat-form-field appearance="outline" class="third-width">
            <mat-label>Classification (Species)</mat-label>
            <mat-select formControlName="species">
              <mat-option *ngFor="let s of speciesOptions" [value]="s._id">
                {{ s.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="species.hasError('required')">
              Classification is required.
            </mat-error>
          </mat-form-field>

          <!-- Dynamic Breeds -->
          <mat-form-field appearance="outline" class="third-width">
            <mat-label>Breed</mat-label>
            <mat-select formControlName="breed">
              <mat-option *ngFor="let b of filteredBreeds" [value]="b._id">
                {{ b.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="breed.hasError('required')">
              Breed is required.
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Row 2: Sex, Age, Date of Purchase -->
        <div class="form-row">
          <mat-form-field appearance="outline" class="third-width">
            <mat-label>Sex</mat-label>
            <mat-select formControlName="sex">
              <mat-option value="male">Male</mat-option>
              <mat-option value="female">Female</mat-option>
            </mat-select>
            <mat-error *ngIf="sex.hasError('required')">
              Sex is required.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="third-width">
            <mat-label>Age</mat-label>
            <input matInput formControlName="age" type="number" min="0" />
            <mat-error *ngIf="age.hasError('required')">
              Age is required.
            </mat-error>
            <mat-error *ngIf="age.hasError('min')">
              Age cannot be negative.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="third-width">
            <mat-label>Date of Purchase</mat-label>
            <input matInput formControlName="dateOfPurchase" type="date" />
            <mat-error *ngIf="dateOfPurchase.hasError('required')">
              Date of Purchase is required.
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Row 3: Farmer, Livestock Group -->
        <div class="form-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Farmer</mat-label>
            <mat-select formControlName="farmer">
              <mat-option *ngFor="let f of farmers" [value]="f.id">
                {{ f.name }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="farmer.hasError('required')">
              Farmer is required.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Livestock Group</mat-label>
            <mat-select formControlName="livestockGroup">
              <mat-option *ngFor="let g of livestockGroups" [value]="g._id">
                {{ g.groupName }}
              </mat-option>
            </mat-select>
            <mat-error *ngIf="livestockGroup.hasError('required')">
              Livestock Group is required.
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Row 4: Checkboxes -->
        <div class="form-row">
          <mat-checkbox formControlName="isDeceased">Deceased</mat-checkbox>
          <mat-checkbox formControlName="isInsured">Insured</mat-checkbox>
        </div>
      </mat-card-content>

      <mat-card-actions align="end">
        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="rxform.invalid || isLoading"
        >
          {{ isLoading ? 'Submitting...' : 'Submit' }}
        </button>
      </mat-card-actions>
    </mat-card>
  </form>
</div>
