
@if(user?.role === 'farmer') {
 <!-- FILTER BAR -->
<div class="livestock-module-container">
   <div class="actions-bar">
    <button mat-raised-button color="primary" (click)="onCreate()" [disabled]="!canCreate">
      Create Group
    </button>
  </div>
  <div class="filter-bar">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search livestock group</mat-label>
      <input matInput [(ngModel)]="searchText" (input)="onSearchChange()">
      <button *ngIf="searchText" matSuffix mat-icon-button (click)="searchText=''; onSearchChange();">
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>

    <mat-form-field appearance="outline" class="sort-field">
      <mat-label>Sort by</mat-label>
      <mat-select [(ngModel)]="sortField" (selectionChange)="onSortChange()">
        <mat-option value="farmer.address.barangay">Barangay</mat-option>
        <mat-option value="groupName">Group Name</mat-option>
        <mat-option value="status">Status</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- CARD GRID -->
  <div class="farmer-card-container">
    @for (item of pagedData; track item._id) {
      <div class="farmer-card">

        <div class="row">
          <span class="label">Group Name</span>
          <span class="value">{{ item.groupName }}</span>
        </div>

        <div class="row">
          <span class="label">Barangay</span>
          <span class="value">
            {{ isUserDto(item.farmer) ? item.farmer.address.barangay : 'â€”' }}
          </span>        
        </div>

        <div class="row">
          <span class="label">Status</span>
          <span class="value status {{ item.status }}">{{ item.status | titlecase }}</span>
        </div>

        <div class="actions">
          <button mat-icon-button color="accent" (click)="onDetails(item._id!)">
            <mat-icon>visibility</mat-icon>
          </button>

          <button mat-icon-button color="primary"
            (click)="onUpdate(item._id!)"
            [disabled]="item.status === 'pending' || item.status === 'verified'">
            <mat-icon>edit</mat-icon>
          </button>
        </div>
      </div>
    }
  </div>

  <!-- PAGINATION -->
  <mat-paginator
    [length]="filteredData.length"
    [pageSize]="pageSize"
    [pageIndex]="pageIndex"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="onPageChange($event)">
  </mat-paginator>
</div>
} @else {

  <!-- default table -->
  <app-generic-table
    [title]="'Livestock Groups'"
    [createButtonLabel]="'Create Livestock'"
    [canCreate]="canCreate"
    (create)="onCreate()"
    [displayedColumns]="displayedColumns"
    [columnDefs]="columnDefs"
    [data]="dataSource.data" 
    [isLoading]="isLoading"
    (details)="onDetails($event)"
    (update)="onUpdate($event)"
  >
    <ng-template #actions let-element>
      <button mat-icon-button color="accent" (click)="onDetails(element._id!)">
        <mat-icon>visibility</mat-icon>
      </button>
      <button
        mat-icon-button
        color="primary"
        (click)="onUpdate(element._id!)"
        *ngIf="user?.role === 'farmer'"
        [disabled]="element.status === 'pending' || element.status === 'verified'"
      >
        <mat-icon>edit</mat-icon>
      </button>
    </ng-template>
  </app-generic-table>

}

