<div class="form-container">
  @if (isLoading) {
    <div class="loading-state">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Preparing the form...</p>
    </div>
  } @else {
    <form [formGroup]="rxform" (ngSubmit)="onSave()" class="user-form">

      <mat-card>
        <mat-card-header>
          <mat-card-title>User Information</mat-card-title>
        </mat-card-header>
        <mat-card-content>

          <!-- Username -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Username</mat-label>
            <input matInput type="text" formControlName="username">
          </mat-form-field>

          <!-- Password Fields -->
          @if (!user._id) {
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Password</mat-label>
              <input matInput type="password" formControlName="password">
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirm Password</mat-label>
              <input matInput type="password" formControlName="passwordConfirm">
            </mat-form-field>
          }

          <!-- Email -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email">
          </mat-form-field>

          <!-- Mobile -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Mobile Number</mat-label>
            <input matInput type="tel" formControlName="mobileNumber">
          </mat-form-field>

          <!-- Address -->
          <div formGroupName="address" class="address-group">
            <h3>Address</h3>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>City</mat-label>
              <mat-select formControlName="city">
                <mat-option value="">-- Select City --</mat-option>
                @for (address of addresses; track address.name) {
                  <mat-option [value]="address.name">{{ address.name }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Barangay</mat-label>
              <mat-select formControlName="barangay">
                <mat-option value="">-- Select Barangay --</mat-option>
                @for (barangay of barangays; track barangay.name) {
                  <mat-option [value]="barangay.name">{{ barangay.name }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>

          <!-- Gender -->
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Gender</mat-label>
            <mat-select formControlName="gender">
              <mat-option value="male">Male</mat-option>
              <mat-option value="female">Female</mat-option>
              <mat-option value="other">Other</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Role -->
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Role</mat-label>
            <mat-select formControlName="role">
              <mat-option value="admin">Admin</mat-option>
              <mat-option value="vet">Veterinarian</mat-option>
              <mat-option value="farmer">Farmer</mat-option>
            </mat-select>
          </mat-form-field>
        </mat-card-content>

        <mat-card-actions align="end">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="!rxform.valid || isLoading">
            Submit
          </button>
        </mat-card-actions>
      </mat-card>
    </form>
  }
</div>
